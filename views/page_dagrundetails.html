{{ block "page_dagrun_details" . }}
<DOCTYPE html>
<html lang="en">
    {{ template "header" }}
    <body data-theme="sunset">
        {{ template "navbar" . }}
        <div class="divider divider-secondary py-4">Run Summary</div>
            {{ template "dagrun_details_summary" . }}
        <div class="divider divider-secondary py-4">Tasks</div>

        <div class="container mx-auto">
            {{ template "dagrun_details_task_list" . }}
        </div>

        {{ template "footer" .Version }}
    </body>
</html>
{{ end }}


{{ block "dagrun_details_summary" . }}
    <!-- Page Title -->
    <h2 class="text-2xl text-center font-bold text-primary mb-4">
        DAG Run Details: #{{ .Details.RunId }} - {{ .Details.DagId }}
    </h2>

    <div id="dagrun_details_summary" class="container m-auto">
        <div class="stats shadow flex flex-row flex-wrap gap-2">
          <div class="stat flex-1 place-items-center">
            <div class="stat-title">Execution time</div>
            <div class="stat-value">{{.Details.ExecTs.ToDisplay}}</div>
          </div>

          <div class="stat flex-1 place-items-center">
            <div class="stat-title">Status</div>
            <div class="stat-value text-secondary">
                {{ if eq .Details.Status "SUCCESS" }}
                    <span class="text-success">‚úÖ SUCCESS</span>
                {{ else if eq .Details.Status "FAILED" }}
                    <span class="text-error">‚ùå FAILED</span>
                {{ else if eq .Details.Status "RUNNING" }}
                    <span class="text-warning">üî• RUNNING</span>
                {{ else if eq .Details.Status "PENDING" }}
                    <span class="text-info">üïí PENDING</span>
                {{ else }}
                    <span class="text-gray-400">‚¨ú NOT STARTED</span>
                {{ end }}
            </div>
          </div>

          <div class="stat flex-1 place-items-center">
            <div class="stat-title">Duration</div>
            <div class="stat-value">{{.Details.Duration}}</div>
          </div>

          <div class="stat flex-1 place-items-center">
            <div class="stat-title">Duration to last 10 runs</div>
            <div class="stat-value">+350ms (13%)</div>
          </div>
        </div>
    </div>
{{ end }}

{{ block "dagrun_details_task_list" . }}
    <!-- Tasks List -->
    <div>
        <h3 class="text-xl font-semibold mb-2">Tasks</h3>
        <ul class="space-y-4">
            {{ range .Details.Tasks }}
            <li class="flex items-center">
                <!-- Indentation with dynamic margin and a vertical line, only on medium screens and up -->
                <div class="hidden md:block md:flex-shrink-0" style="width: {{ .Pos.Indent }}rem;">
                    <div class="border-l-2 border-gray-200 h-full"></div>
                </div>

                <!-- Task Content -->
                <div class="flex-grow p-0 bg-base-100 rounded-lg shadow">
                    <div class="flex justify-between items-center">
                        <!-- Task ID -->
                        <div class="flex flex-col w-full md:w-1/4">
                            <div class="text-xs md:text-sm font-medium text-gray-500">Task</div>
                            <div class="text-sm md:text-lg font-bold text-primary">{{ .TaskId }}</div>
                        </div>

                        <!-- Position -->
                        <div class="flex flex-col w-full md:w-1/6">
                            <div class="text-xs md:text-sm font-medium text-gray-500">Position</div>
                            <div class="text-sm md:text-lg font-bold text-primary">
                                ({{ .Pos.Depth }}, {{ .Pos.Width }})
                            </div>
                        </div>

                        <!-- Status -->
                        <div class="flex flex-col w-full md:w-1/6">
                            <div class="text-sm font-medium text-gray-500">Status</div>
                            {{ template "status" .Status }}
                        </div>

                        <!-- Duration -->
                        <div class="flex flex-col w-full md:w-1/6">
                            <div class="text-xs md:text-sm font-medium text-gray-500">Duration</div>
                            <div class="text-sm md:text-lg font-bold text-primary">{{ .Duration }}</div>
                        </div>

                        <!-- View Logs Button -->
                        <button onclick="document.getElementById('log-window-{{ .TaskId }}').classList.toggle('hidden')"
                            class="btn btn-xs md:btn-sm btn-secondary">
                            View Logs ({{ .TaskLogs.LogRecordsCount }})
                        </button>
                    </div>

                    <!-- Task Logs Window -->
                    <div id="log-window-{{ .TaskId }}" class="mockup-window bg-base-300 border mt-4 hidden">
                        <div class="bg-base-200 px-4 py-4">
                            <h4 class="text-md font-semibold mb-2">Logs ({{ .TaskLogs.LoadedRecords }}/{{ .TaskLogs.LogRecordsCount }}):</h4>
                            <ul class="space-y-2">
                                {{ range .TaskLogs.Records }}
                                <li class="text-sm">
                                    <span class="font-bold text-secondary">{{ .InsertTs.Time }}</span>
                                    {{ if eq .Level "ERR" }}
                                        <span class="font-bold text-red-500">[{{ .Level }}]:</span>
                                        <span class="text-red-500">{{ .Message }}</span>
                                    {{ else }}
                                        <span class="font-medium">[{{ .Level }}]:</span>
                                        <span class="text-gray-400">{{ .Message }}</span>
                                    {{ end }}
                                </li>
                                {{ end }}
                            </ul>
                            <button class="btn btn-xs md:btn-sm btn-info my-4">
                                Sync logs
                            </button>
                        </div>
                    </div>
                </div>
            </li>
            {{ end }}
        </ul>
    </div>
{{ end }}

{{ block "status" . }}
    <div class="text-sm md:text-lg font-bold text-primary">
        {{ if eq . "SUCCESS" }}
            <span class="text-success">‚úÖ SUCCESS</span>
        {{ else if eq . "FAILED" }}
            <span class="text-error">‚ùå FAILED</span>
        {{ else if eq . "RUNNING" }}
            <span class="text-warning">üî• RUNNING</span>
        {{ else if eq . "PENDING" }}
            <span class="text-info">üïí PENDING</span>
        {{ else }}
            <span class="text-gray-400">‚¨ú NOT STARTED</span>
        {{ end }}
    </div>
{{ end }}
